{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WeBlog - Discover Stories</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- AOS CSS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fffaf6;
      color: #333;
    }

    .navbar {
      background-color: #fcefe3;
      padding: 1rem;
      border-bottom: 1px solid #e0d6ce;
    }

    .navbar-brand {
      font-size: 1.6rem;
      font-weight: bold;
      color: #2f2f2f;
    }
    /* Buttons */
    .btn-primary {
      background-color: #e5beb9;
      border: none;
    }

    .btn-primary:hover {
      background-color: #d6a9a4;
    }

    .btn-outline-primary {
      color: #e5beb9;
      border: 1px solid #e5beb9;
    }

    .btn-outline-primary:hover {
      background-color: #e5beb9;
      color: white;
    }

    .blog-card {
      style="width: 250px; height: 400px;"
      border-radius: 12px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .blog-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .card-title {
      font-weight: 600;
    }

    .card-text {
      font-size: 0.95rem;
    }

.category-btn,
.category-link {
  margin-right: 10px;
  text-decoration: none;
  padding: 5px 10px;
  background-color: #f3e8df;
  border-radius: 20px;
  font-size: 0.9rem;
  color: #333;
}

.category-btn:hover,
.category-link:hover {
  background-color: #e6d6cb;
}

.category-btn.active,
.category-link.active {
  background-color: #e6d6cb;
  color: #fff;
}

  </style>
</head>
<body>

{% if messages %}
<div aria-live="polite" aria-atomic="true" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055;">
  {% for message in messages %}
    <div class="toast" role="alert" data-bs-delay="2000" data-bs-autohide="true" style="background-color: #DAF0E1; color: #000;">
      <div class="toast-body">
        {{ message }}
      </div>
    </div>
  {% endfor %}
</div>
{% endif %}

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand">WeBlog</a>
    <div class="ms-auto">
      <a href="/newblog/" class="btn btn-outline-dark me-2">New Blog</a>
      <a href="/profile/" class="btn btn-outline-dark me-2">Profile</a>
      <a href="/logout/" class="btn btn-primary">Logout</a>
    </div>
  </div>
</nav>

<!-- Search Bar -->
<div class="container mt-4">
  <form method="get" action="" class="d-flex">
    <input type="text" name="q" class="form-control me-2" placeholder="Search blogs..." value="{{ request.GET.q }}">
    <button type="submit" class="btn btn-dark">Search</button>
  </form>
</div>

{% if categories %}
<div class="container mt-3">
  <p><strong>Categories:</strong></p>
  
  <!-- 'All' category button -->
  <a href="{% url 'home' %}" class="category-btn {% if not request.GET.category %}active{% endif %}">All</a>
  
  <!-- Loop through each category -->
  {% for cat in categories %}
    <a href="?category={{ cat.name }}" class="category-link {% if request.GET.category == cat.name %}active{% endif %}">{{ cat.name }}</a>
  {% endfor %}
</div>
{% endif %}

<div class="container py-5">
  <div class="row g-4">
    {% for post in page_obj %}
    <div class="col-md-6 col-lg-4 col-xl-3 d-flex">
      <div class="card blog-card w-100 h-100 shadow-sm d-flex flex-column">

        {% if post.image %}
        <img src="{{ post.image.url }}" class="card-img-top" style="height: 200px; object-fit: cover;">
        {% else %}
        <img src="{% static 'images/default-blog.jpg' %}" class="card-img-top" style="height: 200px; object-fit: cover;">
        {% endif %}

        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ post.title }}</h5>
          <p class="card-text small text-muted">
            by <strong>{{ post.author.username }}</strong> â€¢ {{ post.created_at|timesince }} ago
          </p>
          <p class="card-text">{{ post.content|truncatewords:05|safe }}</p>

          <!-- Keep Read More at bottom -->
          <div class="mt-auto">
            <a href="{% url 'blog_detail' post.id %}" class="btn btn-sm btn-primary w-100">Read More</a>
          </div>
        </div>

      </div>
    </div>
    {% empty %}
    <p>No posts found.</p>
    {% endfor %}
  </div>
</div>

<nav aria-label="Page navigation" class="mt-5">
  <ul class="pagination justify-content-center gap-2">

    <!-- Previous Button -->
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link rounded-pill px-3 bg-white text-dark border border-0 shadow-sm" href="?page={{ page_obj.previous_page_number }}">
          &laquo; Prev
        </a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link rounded-pill px-3 text-muted bg-light shadow-sm border-0">
          &laquo; Prev
        </span>
      </li>
    {% endif %}

    <!-- Page Numbers -->
    {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
        <li class="page-item active">
          <span class="page-link rounded-pill px-3 border-0 shadow-sm text-dark" style="background-color: #e6d6cb;">
            {{ num }}
          </span>
        </li>
      {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
        <li class="page-item">
          <a class="page-link rounded-pill px-3 text-dark bg-light shadow-sm border-0" href="?page={{ num }}">
            {{ num }}
          </a>
        </li>
      {% endif %}
    {% endfor %}

    <!-- Next Button -->
    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link rounded-pill px-3 bg-white text-dark border border-0 shadow-sm" href="?page={{ page_obj.next_page_number }}">
          Next &raquo;
        </a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link rounded-pill px-3 text-muted bg-light border-0 shadow-sm">
          Next &raquo;
        </span>
      </li>
    {% endif %}

  </ul>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- AOS JS -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 800,
    once: true
  });
</script>
<script>
  AOS.init();
</script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const toastElList = [].slice.call(document.querySelectorAll('.toast'));

    toastElList.forEach(function(toastEl) {
      const toast = new bootstrap.Toast(toastEl, {
        delay: 1000,  
        autohide: true
      });
      toast.show();
    });
  });
</script>
</body>
</html>

